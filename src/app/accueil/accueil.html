<div class="accueil-container">
  <div class="welcome-card">
    <h1>ğŸ‰ Bienvenue sur votre espace</h1>

    <div class="user-info">
      ğŸ‘¤ ConnectÃ© en tant que : <strong>{{ getUsername() }}</strong>
    </div>

    <div class="user-info">
      ğŸ“§ Email : <strong>{{ getEmail() }}</strong>
    </div>

    <p>Vous Ãªtes maintenant connectÃ© Ã  votre compte sÃ©curisÃ©.</p>

    <div class="navigation-links">
      <a routerLink="/dashboard" class="nav-link">ğŸ“Š AccÃ©der au Tableau de Bord</a>
      <a routerLink="/mes-annonces-offres" class="nav-link">ğŸ“‹ Mes Annonces & Offres</a>
    </div>

    <button class="add-article-btn" (click)="openAddAnnonceModal()">
      â• Publier une annonce
    </button>

    <button class="logout-btn" (click)="logout()">
      ğŸšª DÃ©connexion
    </button>
  </div>

  <div class="error-message" *ngIf="pageError">
    {{ pageError }}
  </div>

  <!-- Annonces Section -->
  <div class="articles-section" *ngIf="annonces.length > 0">
    <div class="articles-title">
      <h2>ğŸ“° Annonces actives</h2>
      <span *ngIf="loading">Chargement...</span>
    </div>
    <div class="articles-grid">
      <div class="article-card" *ngFor="let annonce of annonces" [attr.data-annonce-id]="annonce.id">
        <div class="article-image" *ngIf="annonce.photoProduit">
          <img [src]="annonce.photoProduit" [alt]="annonce.nomProduit" />
        </div>
        <div class="article-content">
          <h3 class="article-name">{{ annonce.nomProduit }}</h3>
          <p class="article-description">{{ annonce.description }}</p>
          <div class="article-meta">
            <span class="article-author">ğŸ‘¤ {{ annonce.user?.nomComplet || annonce.user?.username }}</span>
            <span class="article-date">ğŸ“… {{ formatDate(annonce.dateCreation) }}</span>
          </div>
          <div class="article-meta">
            <span>Type : {{ annonce.type }}</span>
            <span>Ã‰tat : {{ annonce.etat }}</span>
            <span *ngIf="annonce.valeurEstimee">Valeur estimÃ©e : {{ annonce.valeurEstimee | number:'1.0-0' }} DT</span>
          </div>
          <p class="article-description" *ngIf="!annonce.ouverte && annonce.produitRecherche">
            ğŸ¯ Recherche : {{ annonce.produitRecherche }}
          </p>
          <div class="article-actions">
            <button 
              class="make-offer-btn" 
              (click)="openOfferModal(annonce)"
              *ngIf="!isAnnonceOwner(annonce)">
              ğŸ’¼ Faire une offre
            </button>
            <button 
              class="edit-article-btn" 
              (click)="openEditAnnonceModal(annonce)"
              *ngIf="isAnnonceOwner(annonce)">
              âœï¸ Modifier
            </button>
            <button 
              class="delete-article-btn" 
              (click)="deleteAnnonce(annonce.id)"
              *ngIf="isAnnonceOwner(annonce)">
              ğŸ—‘ï¸ Supprimer
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="no-articles" *ngIf="annonces.length === 0 && !loading">
    <p>ğŸ“ Aucune annonce publiÃ©e pour le moment. Cliquez sur "Publier une annonce" pour commencer!</p>
  </div>

  <!-- Modal for Adding Annonce -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditMode() ? 'âœï¸ Modifier l\'annonce' : 'â• Ajouter une annonce' }}</h2>
        <button class="close-btn" (click)="closeModal()">âœ•</button>
      </div>
      
      <form (ngSubmit)="saveAnnonce()" class="article-form">
        <div *ngIf="formError" class="error-message">
          {{ formError }}
        </div>

        <div class="form-group">
          <label for="articleName">Nom du produit *</label>
          <input 
            type="text" 
            id="articleName" 
            [(ngModel)]="nomProduit" 
            name="articleName"
            placeholder="Entrez le nom du produit"
            required
          />
        </div>

        <div class="form-group">
          <label for="articleDescription">Description *</label>
          <textarea 
            id="articleDescription" 
            [(ngModel)]="description" 
            name="articleDescription"
            placeholder="DÃ©crivez le produit proposÃ©"
            rows="4"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="type">CatÃ©gorie</label>
          <select id="type" name="type" [(ngModel)]="type">
            <option value="AUTRE">Autre</option>
            <option value="ELECTRONIQUE">Ã‰lectronique</option>
            <option value="MAISON">Maison</option>
            <option value="SPORT">Sport</option>
            <option value="JEUX">Jeux & Loisirs</option>
          </select>
        </div>

        <div class="form-group">
          <label for="etat">Ã‰tat</label>
          <select id="etat" name="etat" [(ngModel)]="etat">
            <option>Neuf</option>
            <option>Bon Ã©tat</option>
            <option>UsÃ©</option>
          </select>
        </div>

        <div class="form-group">
          <label for="valeur">Valeur estimÃ©e (DT)</label>
          <input
            type="number"
            id="valeur"
            name="valeur"
            [(ngModel)]="valeurEstimee"
            min="0"
            step="10"
            placeholder="Ex: 250"
          />
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" [(ngModel)]="ouverte" name="ouverte" />
            Acceptes-tu tous types d'Ã©changes ?
          </label>
        </div>

        <div class="form-group" *ngIf="!ouverte">
          <label for="produitRecherche">Produit recherchÃ©</label>
          <input
            type="text"
            id="produitRecherche"
            name="produitRecherche"
            [(ngModel)]="produitRecherche"
            placeholder="DÃ©cris ce que tu recherches"
          />
        </div>

        <div class="form-group">
          <label for="articleImage">Image (URL ou fichier)</label>
          <input
            type="text"
            id="photoProduit"
            name="photoProduit"
            [(ngModel)]="photoProduit"
            placeholder="https://exemple.com/mon-produit.jpg"
          />
          <input 
            type="file" 
            id="articleImage" 
            name="articleImage"
            accept="image/*"
            (change)="onImageSelected($event)"
          />
          <div class="image-preview" *ngIf="imagePreview">
            <img [src]="imagePreview" alt="Preview" />
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeModal()">
            Annuler
          </button>
          <button type="submit" class="submit-btn">
            {{ saving ? 'Enregistrement...' : isEditMode() ? 'ğŸ’¾ Mettre Ã  jour' : 'âœ… Publier' }}
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Offer Modal -->
  <div class="modal-overlay" *ngIf="showOfferModal" (click)="closeOfferModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>ğŸ’¼ Faire une offre</h2>
        <button class="close-btn" (click)="closeOfferModal()">âœ•</button>
      </div>
      
      <div class="offer-annonce-info" *ngIf="selectedAnnonceForOffer">
        <h3>Annonce: {{ selectedAnnonceForOffer.nomProduit }}</h3>
        <p>{{ selectedAnnonceForOffer.description }}</p>
      </div>
      
      <form (ngSubmit)="submitOffer()" class="article-form">
        <div class="form-group">
          <label for="offerMessage">Message *</label>
          <textarea 
            id="offerMessage" 
            [(ngModel)]="offerMessage" 
            name="offerMessage"
            placeholder="DÃ©crivez votre offre ou le produit que vous proposez"
            rows="4"
            required
          ></textarea>
        </div>

        <div class="form-group">
          <label for="offerNomProduit">Nom du produit proposÃ© (optionnel)</label>
          <input 
            type="text" 
            id="offerNomProduit" 
            [(ngModel)]="offerNomProduit" 
            name="offerNomProduit"
            placeholder="Ex: iPhone 13"
          />
        </div>

        <div class="form-group">
          <label for="offerEtatProduit">Ã‰tat du produit</label>
          <select id="offerEtatProduit" name="offerEtatProduit" [(ngModel)]="offerEtatProduit">
            <option>Neuf</option>
            <option>Bon Ã©tat</option>
            <option>UsÃ©</option>
          </select>
        </div>

        <div class="form-group">
          <label for="offerValeurEstimee">Valeur estimÃ©e (DT)</label>
          <input
            type="number"
            id="offerValeurEstimee"
            name="offerValeurEstimee"
            [(ngModel)]="offerValeurEstimee"
            min="0"
            step="10"
            placeholder="Ex: 250"
          />
        </div>

        <div class="form-group">
          <label for="offerImage">Photo du produit (optionnel)</label>
          <input 
            type="file" 
            id="offerImage" 
            name="offerImage"
            accept="image/*"
            (change)="onOfferImageSelected($event)"
          />
          <div class="image-preview" *ngIf="offerImagePreview">
            <img [src]="offerImagePreview" alt="Preview" />
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="cancel-btn" (click)="closeOfferModal()">
            Annuler
          </button>
          <button type="submit" class="submit-btn">
            âœ… Envoyer l'offre
          </button>
        </div>
      </form>
    </div>
  </div>
</div>